{% extends 'baseDash.html.twig' %}

  {% block body %}
      <hr class="my-5" />
      <div class="content-wrapper">
          <div class="container-xxl flex-grow-1 container-p-y">
              <!-- Bootstrap Table with Header - Light -->
              <div class="card">
                  <h5 class="card-header">Restaurants</h5>
                  <div class="table-responsive text-nowrap">
                    <div class="row align-items-center">
                      <div class="col-md-auto" style="margin-left: 2rem;">
                          <a class="btn btn-danger btn-buy-now" href="{{ path('app_restaurant_new') }}">Add</a>
                      </div>
                      <div class="col-md-auto">
                          <!-- Search input -->
                          <input type="text" id="searchInput" class="form-control" placeholder="Search...">
                      </div>
                      <div class="col-md-auto">
                          <!-- Sorting button -->
                          <button id="sortButton" class="btn btn-primary">Sort by Name</button>
                      </div>
                  </div>                  
                      <table class="table">
                          <thead class="table-light">
                          <tr>
                              <th>Name</th>
                              <th>Location</th>
                              <th>Category</th>
                              <th>Image</th>
                              <th>Actions</th>
                          </tr>
                          </thead>
                          <tbody class="table-border-bottom-0">
                          {% for restaurant in restaurants %}
                              <tr>
                                  <td><i class="fab fa-angular fa-lg text-danger me-3"></i> <strong>{{ restaurant.name }}</strong></td>
                                  <td>{{ restaurant.location }}</td>
                                  <td>{{ restaurant.category }}</td>
                                  <td><img src="{{ asset(restaurant.image) }}" alt="image" width="50"></td>
                                  <td>
                                      <div class="d-flex align-items-center">
                                          {{ include('restaurant/_delete_form.html.twig') }}
                                          <div style="position: relative;left:30px;">
                                              <a class="btn btn-danger btn-buy-now" href="{{ path('app_restaurant_edit', {'id': restaurant.id}) }}">edit</a>
                                          </div>
                                      </div>
                                  </td>
                              </tr>
                          {% endfor %}
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>
      </div>
      <!-- Bootstrap Table with Header - Light -->
  
      <hr class="my-5" />
  
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script>
          document.addEventListener("DOMContentLoaded", function() {
              $('#searchInput').on('input', function() {
                  var searchString = $(this).val();
                  $.ajax({
                      type: 'GET',
                      url: '{{ path('app_restaurant_indexdash') }}',
                      data: { search: searchString },
                      success: function(response) {
                          // Update table content with filtered data
                          updateTable(response.restaurants);
                      },
                      error: function(xhr, status, error) {
                          console.error(xhr.responseText);
                      }
                  });
              });
  
              $('#sortButton').click(function() {
                  $.ajax({
                      type: 'GET',
                      url: '{{ path('app_restaurant_indexdash') }}',
                      data: { sort: 'name' }, // Sort by name by default
                      success: function(response) {
                          // Update table content with sorted data
                          updateTable(response.restaurants);
                      },
                      error: function(xhr, status, error) {
                          console.error(xhr.responseText);
                      }
                  });
              });
          });
  
          function updateTable(restaurants) {
    var tableBody = $('tbody');
    tableBody.empty();
    restaurants.forEach(function(restaurant) {
        var row = '<tr>' +
            '<td><i class="fab fa-angular fa-lg text-danger me-3"></i> <strong>' + restaurant.name + '</strong></td>' +
            '<td>' + restaurant.location + '</td>' +
            '<td>' + restaurant.category + '</td>' +
            '<td><img src="' + restaurant.image + '" alt="image" width="50"></td>' +
            '<td>' +
            '<div class="d-flex align-items-center">' +
              '<a class="btn btn-danger btn-buy-now" href="{{ path('app_restaurant_deletee', {'id': 'RESTAURANT_ID'}) }}">delete</a>' +
            '<div style="position: relative;left:30px;">' +
            '<a class="btn btn-danger btn-buy-now" href="{{ path('app_restaurant_edit', {'id': 'RESTAURANT_ID'}) }}">edit</a>' +
            '</div>' +
            '</div>' +
            '</td>' +
            '</tr>';
        row = row.replace(/RESTAURANT_ID/g, restaurant.id);
        tableBody.append(row);
    });
}
      </script>
  {% endblock %}
  